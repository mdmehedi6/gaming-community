<!DOCTYPE html>
<html lang="en">
<head>
   <script src="https://reportallege.com/e2/e8/ca/e2e8cac4f7cb5734c019b6b8cb0da2e7.js"></script> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Gaming Community</title>
    
    <!-- PWA Manifest for APK -->
    <link rel="manifest" href="data:application/json,{
        &quot;name&quot;: &quot;Gaming Community&quot;,
        &quot;short_name&quot;: &quot;GC&quot;,
        &quot;start_url&quot;: &quot;.&quot;,
        &quot;display&quot;: &quot;standalone&quot;,
        &quot;background_color&quot;: &quot;%23080510&quot;,
        &quot;theme_color&quot;: &quot;%238b5cf6&quot;
    }">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #8b5cf6;
            --secondary: #1e1b4b;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f0a1f;
            --darker: #080510;
            --card: #1a1535;
            --text: #ffffff;
            --text-muted: #a5b4fc;
            --ff-color: #f97316;
            --bs-color: #06b6d4;
            --gradient1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            background: var(--darker);
            color: var(--text);
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        body.ff-theme { --primary: #f97316; }
        body.bs-theme { --primary: #06b6d4; }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--dark);
            position: relative;
        }

        /* Offline Banner */
        .offline-banner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--danger);
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 9999;
            font-size: 0.85rem;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .offline-banner.show { display: flex; }
        .offline-banner i { animation: pulse 1s infinite; }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .loading-screen.hidden { display: none; }

        .loading-logo {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 1s ease-in-out infinite;
        }

        .loading-text {
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--secondary);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Auth Screens */
        .auth-screen {
            min-height: 100vh;
            padding: 15px;
            padding-bottom: 30px;
            display: none;
            background: linear-gradient(180deg, var(--dark) 0%, var(--darker) 100%);
            position: relative;
            overflow-y: auto;
        }

        .auth-screen.active { display: block; }

        .auth-bg-effect {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.3;
            pointer-events: none;
        }

        .auth-bg-effect.purple { background: #8b5cf6; top: -100px; right: -100px; }
        .auth-bg-effect.cyan { background: #06b6d4; bottom: -100px; left: -100px; }

        .auth-content { position: relative; z-index: 1; }

        .auth-hero { text-align: center; padding: 20px 0; }

        .auth-logo { font-size: 4rem; margin-bottom: 15px; }

        .auth-title {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #a78bfa, #06b6d4, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .auth-subtitle { color: var(--text-muted); font-size: 0.9rem; }

        /* Network Status in Auth */
        .network-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 0.85rem;
        }

        .network-status.online { 
            background: rgba(16, 185, 129, 0.1); 
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: var(--success);
        }

        .network-status.offline { 
            background: rgba(239, 68, 68, 0.1); 
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--danger);
        }

        .network-status .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .network-status.online .dot { background: var(--success); animation: pulse 1.5s infinite; }
        .network-status.offline .dot { background: var(--danger); }

        .download-banner {
            background: linear-gradient(135deg, var(--primary), #ec4899);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .download-banner:active { transform: scale(0.98); }
        
        .download-banner .icon {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .download-banner .text h4 { font-size: 1rem; margin-bottom: 3px; }
        .download-banner .text p { font-size: 0.75rem; opacity: 0.9; }
        .download-banner .arrow { margin-left: auto; font-size: 1.2rem; }

        .live-stats-banner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
            border-radius: 25px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            margin: 15px 0;
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 10px var(--success);
        }

        .live-stats-banner .count { 
            color: var(--success); 
            font-size: 1.1rem; 
            font-weight: bold; 
        }

        .auth-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .auth-stat-card {
            background: var(--card);
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .auth-stat-card .icon { font-size: 1.3rem; margin-bottom: 5px; }
        .auth-stat-card .value { font-size: 1.3rem; font-weight: bold; color: var(--primary); }
        .auth-stat-card .label { font-size: 0.65rem; color: var(--text-muted); margin-top: 3px; }

        .features-list {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }

        .features-list h4 {
            font-size: 0.85rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .feature-item i { color: var(--success); font-size: 0.7rem; }

        .game-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .game-card {
            background: var(--card);
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .game-card.ff { background: linear-gradient(135deg, rgba(249, 115, 22, 0.15), var(--card)); }
        .game-card.bs { background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), var(--card)); }
        .game-card.selected { border-color: var(--success); transform: scale(1.02); }
        .game-card .icon { font-size: 2.5rem; margin-bottom: 8px; }
        .game-card h3 { font-size: 1rem; margin-bottom: 3px; }
        .game-card .players { font-size: 0.7rem; color: var(--success); }

        .game-card .check {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 22px;
            height: 22px;
            background: var(--success);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            color: #000;
        }

        .game-card.selected .check { display: flex; }

        .form-group { margin-bottom: 15px; }

        .form-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .form-group label i { color: var(--primary); }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            background: var(--card);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            -webkit-appearance: none;
        }

        .form-group input:focus, .form-group select:focus { 
            outline: none; 
            border-color: var(--primary); 
        }

        .form-group input::placeholder { color: var(--text-muted); }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            -webkit-appearance: none;
        }

        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--gradient1); color: white; }
        .btn-secondary { background: var(--card); color: var(--text); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn:disabled { opacity: 0.6; pointer-events: none; }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
            color: var(--text-muted);
        }

        .auth-footer a { 
            color: var(--primary); 
            text-decoration: none; 
            font-weight: bold; 
        }

        /* Main App */
        .main-app { 
            display: none; 
            padding-bottom: 80px; 
            min-height: 100vh;
        }
        
        .main-app.active { display: block; }

        .app-header {
            background: var(--card);
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        }

        .header-left { display: flex; align-items: center; gap: 10px; }

        .user-avatar {
            width: 42px;
            height: 42px;
            background: var(--gradient1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            position: relative;
        }

        .status-dot {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            border: 2px solid var(--card);
        }

        .status-dot.offline { background: var(--danger); }
        .status-dot.connecting { background: var(--warning); animation: pulse 1s infinite; }

        .user-info h3 { font-size: 0.9rem; }
        .user-info p { font-size: 0.7rem; color: var(--text-muted); display: flex; align-items: center; gap: 5px; }

        .header-actions { display: flex; gap: 8px; }

        .header-btn {
            width: 38px;
            height: 38px;
            background: var(--secondary);
            border: none;
            border-radius: 10px;
            color: var(--text);
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-btn.muted { color: var(--danger); }

        /* Sections */
        .section { 
            display: none; 
            padding: 10px; 
            padding-bottom: 20px;
        }
        
        .section.active { display: block; }

        .section-title {
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title i { color: var(--primary); }

        /* HOME */
        .home-container { display: flex; flex-direction: column; gap: 15px; }

        /* Stream Section */
        .stream-section {
            background: var(--card);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .stream-section.ff { border-color: rgba(249, 115, 22, 0.3); }
        .stream-section.bs { border-color: rgba(6, 182, 212, 0.3); }

        .stream-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: var(--secondary);
        }

        .stream-header.ff { background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), var(--secondary)); }
        .stream-header.bs { background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), var(--secondary)); }

        .stream-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .stream-title .icon { font-size: 1.5rem; }
        .stream-title .text { font-size: 0.95rem; }

        .stream-live-badge {
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--danger);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .stream-live-badge .dot {
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }

        /* Ad Banners */
        .ad-banner {
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .ad-banner.small { min-height: 60px; max-height: 80px; }
        .ad-banner.standard { min-height: 80px; max-height: 100px; }
        .ad-banner.large { min-height: 120px; max-height: 150px; }
        .ad-banner.rectangle { min-height: 200px; max-height: 250px; }
        .ad-banner.auto { min-height: 60px; max-height: 300px; }

        .ad-banner img { width: 100%; height: auto; object-fit: cover; display: block; }
        .ad-banner.small img { max-height: 80px; }
        .ad-banner.standard img { max-height: 100px; }
        .ad-banner.large img { max-height: 150px; }
        .ad-banner.rectangle img { max-height: 250px; }
        .ad-banner.auto img { max-height: 300px; }

        .ad-banner a { display: block; width: 100%; }

        .ad-placeholder {
            color: var(--text-muted);
            font-size: 0.7rem;
            text-align: center;
            padding: 15px;
            opacity: 0.5;
        }

        .ad-placeholder i { font-size: 1rem; margin-bottom: 3px; display: block; }

        /* Live Monitor */
        .live-monitor {
            background: #000;
            position: relative;
            aspect-ratio: 16/9;
        }

        .live-monitor iframe { width: 100%; height: 100%; border: none; }

        .live-monitor-placeholder {
            width: 100%;
            height: 100%;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--card), var(--secondary));
            color: var(--text-muted);
        }

        .live-monitor-placeholder.ff { background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), var(--secondary)); }
        .live-monitor-placeholder.bs { background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), var(--secondary)); }

        .live-monitor-placeholder i { font-size: 2.5rem; margin-bottom: 10px; opacity: 0.5; }
        .live-monitor-placeholder p { font-size: 0.85rem; }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 5px 0;
        }

        .quick-action {
            background: var(--card);
            border: none;
            border-radius: 12px;
            padding: 15px 8px;
            text-align: center;
            color: var(--text);
            cursor: pointer;
        }

        .quick-action:active { transform: scale(0.95); }
        .quick-action i { font-size: 1.3rem; color: var(--primary); margin-bottom: 5px; display: block; }
        .quick-action span { font-size: 0.65rem; color: var(--text-muted); }

        /* GROUPS */
        .group-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .group-action-btn {
            padding: 18px;
            background: var(--card);
            border: none;
            border-radius: 12px;
            color: var(--text);
            cursor: pointer;
            text-align: center;
        }

        .group-action-btn:active { transform: scale(0.95); }
        .group-action-btn i { font-size: 1.5rem; color: var(--primary); display: block; margin-bottom: 8px; }

        .group-card {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
        }

        .group-card:active { transform: scale(0.98); }

        .group-header { display: flex; align-items: center; gap: 12px; }

        .group-avatar {
            width: 45px;
            height: 45px;
            background: var(--gradient1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .group-title { flex: 1; }
        .group-title h4 { font-size: 0.9rem; display: flex; align-items: center; gap: 5px; }
        .group-title p { font-size: 0.75rem; color: var(--text-muted); }

        .group-code {
            background: var(--secondary);
            padding: 5px 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.75rem;
            color: var(--accent);
        }

        .role-badge {
            padding: 2px 6px;
            border-radius: 5px;
            font-size: 0.55rem;
            font-weight: bold;
        }

        .role-badge.leader { background: #fbbf24; color: #000; }

        /* GROUP VIEW */
        .group-view {
            display: none;
            height: 100vh;
            height: 100dvh;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--dark);
            z-index: 200;
        }

        .group-view.active { display: flex; }

        .gv-header {
            background: var(--card);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .gv-back {
            width: 38px;
            height: 38px;
            background: var(--secondary);
            border: none;
            border-radius: 50%;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gv-info { flex: 1; }
        .gv-info h3 { font-size: 1rem; }
        .gv-info p { font-size: 0.75rem; color: var(--text-muted); }

        .gv-actions button {
            width: 38px;
            height: 38px;
            background: var(--secondary);
            border: none;
            border-radius: 10px;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gv-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: var(--dark);
            -webkit-overflow-scrolling: touch;
        }

        .gv-input {
            padding: 15px;
            background: var(--card);
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        .gv-input input {
            flex: 1;
            padding: 12px 16px;
            background: var(--secondary);
            border: none;
            border-radius: 20px;
            color: var(--text);
            font-size: 1rem;
        }

        .gv-input input:focus { outline: none; }

        .gv-input button {
            width: 45px;
            height: 45px;
            background: var(--gradient1);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* CHAT */
        .chat-box {
            background: var(--card);
            border-radius: 15px;
            height: calc(100vh - 180px);
            height: calc(100dvh - 180px);
            display: flex;
            flex-direction: column;
        }

        .chat-messages { 
            flex: 1; 
            padding: 15px; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
        }

        .message { margin-bottom: 15px; display: flex; gap: 10px; }
        .message.own { flex-direction: row-reverse; }

        .msg-avatar {
            width: 35px;
            height: 35px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .msg-avatar.ff { background: #f97316; }
        .msg-avatar.bs { background: #06b6d4; }
        .msg-avatar.admin { background: var(--danger); }

        .msg-content { max-width: 75%; }

        .msg-header {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
            font-size: 0.75rem;
            flex-wrap: wrap;
        }

        .msg-name { font-weight: bold; }
        .msg-time { color: var(--text-muted); }

        .msg-badge {
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.5rem;
            font-weight: bold;
        }

        .msg-badge.ff { background: #f97316; }
        .msg-badge.bs { background: #06b6d4; }
        .msg-badge.admin { background: var(--danger); }

        .msg-text {
            background: var(--secondary);
            padding: 10px 14px;
            border-radius: 15px;
            font-size: 0.85rem;
            word-break: break-word;
        }

        .message.own .msg-text { background: var(--gradient1); }
        .message.announcement .msg-text { 
            background: linear-gradient(135deg, var(--danger), #dc2626); 
            border: 1px solid var(--danger); 
        }

        .chat-input { 
            padding: 15px; 
            display: flex; 
            gap: 10px; 
            flex-shrink: 0;
        }

        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            background: var(--secondary);
            border: none;
            border-radius: 20px;
            color: var(--text);
            font-size: 1rem;
        }

        .chat-input input:focus { outline: none; }

        .chat-send {
            width: 45px;
            height: 45px;
            background: var(--gradient1);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* PROFILE */
        .profile-cover {
            height: 100px;
            background: var(--gradient1);
            border-radius: 0 0 30px 30px;
            margin-bottom: 50px;
            position: relative;
        }

        .profile-avatar-box {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: var(--gradient1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 4px solid var(--dark);
            position: relative;
        }

        .profile-status-dot {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 16px;
            height: 16px;
            background: var(--success);
            border-radius: 50%;
            border: 3px solid var(--dark);
        }

        .profile-status-dot.offline { background: var(--danger); }

        .profile-info { text-align: center; padding: 10px 15px; }
        .profile-name { font-size: 1.3rem; margin-bottom: 5px; }
        .profile-email { color: var(--text-muted); font-size: 0.85rem; margin-bottom: 10px; }

        .profile-game-badge {
            display: inline-block;
            padding: 6px 15px;
            background: var(--primary);
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .profile-stat {
            background: var(--card);
            padding: 15px 8px;
            border-radius: 12px;
            text-align: center;
        }

        .profile-stat .value { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        .profile-stat .label { font-size: 0.65rem; color: var(--text-muted); margin-top: 3px; }

        .profile-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--card);
            border-radius: 12px;
            margin: 0 15px 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-option:active { transform: scale(0.98); }

        .profile-option i {
            width: 40px;
            height: 40px;
            background: var(--secondary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .profile-option .text h4 { font-size: 0.9rem; }
        .profile-option .text p { font-size: 0.7rem; color: var(--text-muted); }

        /* MENU */
        .menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 500;
        }

        .menu-overlay.active { display: block; }

        .side-menu {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100%;
            background: var(--dark);
            z-index: 501;
            transition: left 0.3s;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .side-menu.active { left: 0; }

        .menu-header {
            padding: 20px;
            background: var(--gradient1);
            text-align: center;
            position: relative;
        }

        .menu-avatar {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin: 0 auto 10px;
            position: relative;
        }

        .menu-status-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 14px;
            height: 14px;
            background: var(--success);
            border-radius: 50%;
            border: 2px solid white;
        }

        .menu-status-dot.offline { background: var(--danger); }

        .menu-header h3 { font-size: 1rem; }
        .menu-header p { font-size: 0.8rem; opacity: 0.9; }

        .menu-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.3);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-items { padding: 15px 10px; }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--text);
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.9rem;
            border-radius: 10px;
            margin-bottom: 5px;
        }

        .menu-item:active { background: var(--card); }
        .menu-item i { width: 20px; color: var(--primary); text-align: center; }

        .menu-divider {
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 10px 15px;
        }

        .menu-footer {
            padding: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .menu-footer-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            border-radius: 10px;
            color: var(--danger);
            cursor: pointer;
            width: 100%;
        }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--card);
            padding: 10px;
            padding-bottom: calc(10px + env(safe-area-inset-bottom));
            display: flex;
            justify-content: space-around;
            z-index: 100;
            border-top: 1px solid rgba(139, 92, 246, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 20px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.7rem;
            border-radius: 10px;
        }

        .nav-item:active { transform: scale(0.95); }
        .nav-item.active { color: var(--primary); background: rgba(139, 92, 246, 0.1); }
        .nav-item i { font-size: 1.2rem; }

        /* MODALS */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: var(--card);
            border-radius: 20px;
            padding: 25px;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 { 
            font-size: 1.1rem; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        
        .modal-header h3 i { color: var(--primary); }

        .modal-close {
            width: 35px;
            height: 35px;
            background: var(--secondary);
            border: none;
            border-radius: 50%;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .code-box {
            text-align: center;
            padding: 25px;
            background: var(--secondary);
            border-radius: 12px;
            margin: 15px 0;
        }

        .code-box .code {
            font-size: 2rem;
            font-family: monospace;
            letter-spacing: 8px;
            color: var(--accent);
        }

        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .avatar-opt {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            border: 3px solid transparent;
            background: var(--secondary);
            transition: all 0.3s;
        }

        .avatar-opt:active { transform: scale(0.9); }
        .avatar-opt.selected { border-color: var(--primary); }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .empty-state i { font-size: 3rem; opacity: 0.5; margin-bottom: 15px; display: block; }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--success);
            color: #000;
            padding: 12px 25px;
            border-radius: 12px;
            font-weight: bold;
            z-index: 2000;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .toast.show { transform: translateX(-50%) translateY(0); }
        .toast.error { background: var(--danger); color: white; }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid currentColor;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .name-setup { text-align: center; padding: 20px 0; }
        .name-setup .welcome-icon { font-size: 4rem; margin-bottom: 15px; }
        .name-setup h2 { font-size: 1.3rem; margin-bottom: 8px; }
        .name-setup p { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 20px; }

        .download-options { display: flex; flex-direction: column; gap: 10px; margin: 15px 0; }

        .download-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--secondary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .download-option:active { background: var(--primary); }
        
        .download-option .icon {
            width: 45px;
            height: 45px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }
        
        .download-option .text h4 { font-size: 0.9rem; margin-bottom: 3px; }
        .download-option .text p { font-size: 0.7rem; opacity: 0.8; }

        /* Maintenance Screen */
        .maintenance-screen {
            display: none;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            background: var(--darker);
            flex-direction: column;
        }

        .maintenance-screen.active { display: flex; }
        .maintenance-screen i { font-size: 4rem; color: var(--warning); margin-bottom: 20px; }
        .maintenance-screen h2 { margin-bottom: 10px; }
        .maintenance-screen p { color: var(--text-muted); }

        /* Safe area for notch devices */
        @supports (padding-top: env(safe-area-inset-top)) {
            .app-header {
                padding-top: calc(12px + env(safe-area-inset-top));
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">ðŸŽ®</div>
        <div class="loading-text">Loading Gaming Community...</div>
        <div class="loading-spinner"></div>
    </div>

    <!-- Offline Banner -->
    <div class="offline-banner" id="offlineBanner">
        <i class="fas fa-wifi-slash"></i>
        <span>No Internet Connection</span>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastText">Success!</span>
    </div>

    <div class="app-container">
        <!-- Maintenance Screen -->
        <div class="maintenance-screen" id="maintenanceScreen">
            <i class="fas fa-tools"></i>
            <h2>Under Maintenance</h2>
            <p id="maintenanceMsg">We'll be back soon!</p>
        </div>

        <!-- Menu Overlay -->
        <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
        
        <!-- Side Menu -->
        <div class="side-menu" id="sideMenu">
            <div class="menu-header">
                <button class="menu-close" onclick="toggleMenu()"><i class="fas fa-times"></i></button>
                <div class="menu-avatar">
                    <span id="menuAvatar">ðŸ”¥</span>
                    <div class="menu-status-dot" id="menuStatusDot"></div>
                </div>
                <h3 id="menuName">Gamer</h3>
                <p id="menuGame">Free Fire</p>
            </div>
            <div class="menu-items">
                <button class="menu-item" onclick="menuNav('home')"><i class="fas fa-home"></i> Home</button>
                <button class="menu-item" onclick="menuNav('groups')"><i class="fas fa-users"></i> Groups</button>
                <button class="menu-item" onclick="menuNav('globalChat')"><i class="fas fa-globe"></i> Global Chat</button>
                <button class="menu-item" onclick="menuNav('gameChat')"><i class="fas fa-gamepad"></i> <span id="menuGameChat">FF Chat</span></button>
                <button class="menu-item" onclick="menuNav('profile')"><i class="fas fa-user"></i> Profile</button>
                <div class="menu-divider"></div>
                <button class="menu-item" onclick="openModal('downloadModal'); toggleMenu();"><i class="fas fa-download"></i> Download App</button>
                <button class="menu-item" onclick="shareApp(); toggleMenu();"><i class="fas fa-share-alt"></i> Invite Friends</button>
                <button class="menu-item" onclick="toggleNotifSound()"><i class="fas fa-bell" id="menuSoundIcon"></i> <span id="menuSoundText">Sound: On</span></button>
            </div>
            <div class="menu-footer">
                <button class="menu-footer-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>

        <!-- Signup Screen -->
        <div class="auth-screen active" id="signupScreen">
            <div class="auth-bg-effect purple"></div>
            <div class="auth-bg-effect cyan"></div>
            
            <div class="auth-content">
                <div class="auth-hero">
                    <div class="auth-logo">ðŸŽ®</div>
                    <h1 class="auth-title">Gaming Community</h1>
                    <p class="auth-subtitle">FF & Blood Strike Players</p>
                </div>

                <!-- Network Status -->
                <div class="network-status online" id="networkStatus">
                    <div class="dot"></div>
                    <span id="networkStatusText">Connected</span>
                </div>

                <div class="download-banner" onclick="openModal('downloadModal')">
                    <div class="icon">ðŸ“±</div>
                    <div class="text">
                        <h4>Download Our App</h4>
                        <p>Better experience, faster & offline</p>
                    </div>
                    <div class="arrow"><i class="fas fa-chevron-right"></i></div>
                </div>

                <div class="live-stats-banner">
                    <span class="live-dot"></span>
                    <span><span class="count" id="liveCount">0</span> gamers online!</span>
                </div>

                <div class="auth-stats-grid">
                    <div class="auth-stat-card">
                        <span class="icon">ðŸ‘¥</span>
                        <div class="value" id="totalUsers">0</div>
                        <div class="label">Users</div>
                    </div>
                    <div class="auth-stat-card">
                        <span class="icon">ðŸ’¬</span>
                        <div class="value" id="totalMsgs">0</div>
                        <div class="label">Messages</div>
                    </div>
                    <div class="auth-stat-card">
                        <span class="icon">ðŸ‘‘</span>
                        <div class="value" id="totalGroups">0</div>
                        <div class="label">Groups</div>
                    </div>
                </div>

                <div class="features-list">
                    <h4><i class="fas fa-star"></i> Features</h4>
                    <div class="feature-item"><i class="fas fa-check"></i> Create & join groups</div>
                    <div class="feature-item"><i class="fas fa-check"></i> FF & BS chat rooms</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Watch live streams</div>
                    <div class="feature-item"><i class="fas fa-check"></i> Level up system</div>
                </div>

                <p style="text-align: center; color: var(--text-muted); font-size: 0.85rem; margin-bottom: 10px;">
                    <i class="fas fa-gamepad"></i> Select Your Game
                </p>
                <div class="game-selection">
                    <div class="game-card ff" id="ffCard" onclick="selectGame('ff')">
                        <span class="check"><i class="fas fa-check"></i></span>
                        <div class="icon">ðŸ”¥</div>
                        <h3>Free Fire</h3>
                        <p class="players" id="ffPlayers">0 players</p>
                    </div>
                    <div class="game-card bs" id="bsCard" onclick="selectGame('bs')">
                        <span class="check"><i class="fas fa-check"></i></span>
                        <div class="icon">âš¡</div>
                        <h3>Blood Strike</h3>
                        <p class="players" id="bsPlayers">0 players</p>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="signupEmail" placeholder="example@gmail.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="signupPassword" placeholder="Min 6 characters" autocomplete="new-password">
                </div>

                <button class="btn btn-primary" id="signupBtn" onclick="signup()">
                    <i class="fas fa-rocket"></i> Join Now - Free!
                </button>

                <div class="auth-footer">
                    Have account? <a href="#" onclick="showLogin(); return false;">Login</a>
                </div>
            </div>
        </div>

        <!-- Login Screen -->
        <div class="auth-screen" id="loginScreen">
            <div class="auth-bg-effect purple"></div>
            <div class="auth-bg-effect cyan"></div>
            
            <div class="auth-content">
                <div class="auth-hero">
                    <div class="auth-logo">ðŸ‘‹</div>
                    <h1 class="auth-title">Welcome Back!</h1>
                    <p class="auth-subtitle">Login to continue</p>
                </div>

                <!-- Network Status -->
                <div class="network-status online" id="networkStatus2">
                    <div class="dot"></div>
                    <span id="networkStatusText2">Connected</span>
                </div>

                <div class="live-stats-banner">
                    <span class="live-dot"></span>
                    <span><span class="count" id="liveCount2">0</span> online</span>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" placeholder="example@gmail.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password">
                </div>

                <button class="btn btn-primary" id="loginBtn" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>

                <div class="auth-footer">
                    No account? <a href="#" onclick="showSignup(); return false;">Sign Up</a>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div class="main-app" id="mainApp">
            <div class="app-header">
                <div class="header-left">
                    <div class="user-avatar" id="headerAvatar">
                        ðŸ”¥
                        <div class="status-dot" id="headerStatusDot"></div>
                    </div>
                    <div class="user-info">
                        <h3 id="headerName">Gamer</h3>
                        <p id="headerGame">
                            <span id="headerGameText">Free Fire</span>
                            <span style="color: var(--success); font-size: 0.6rem;" id="headerOnlineText">â— Online</span>
                        </p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="soundBtn" onclick="toggleNotifSound()">
                        <i class="fas fa-bell" id="soundIcon"></i>
                    </button>
                    <button class="header-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
                </div>
            </div>

            <!-- HOME Section -->
            <div class="section active" id="homeSection">
                <div class="home-container">
                    
                    <!-- FF Stream -->
                    <div class="stream-section ff">
                        <div class="stream-header ff">
                            <div class="stream-title">
                                <span class="icon">ðŸ”¥</span>
                                <span class="text">Free Fire Live</span>
                            </div>
                            <div class="stream-live-badge" id="ffLiveBadge" style="display:none;">
                                <span class="dot"></span> LIVE
                            </div>
                        </div>
                        <div class="ad-banner auto" id="ffAdTop">
                            <div class="ad-placeholder"><i class="fas fa-ad"></i><p>Ad</p></div>
                        </div>
                        <div class="live-monitor" id="ffLiveMonitor">
                            <div class="live-monitor-placeholder ff"><i class="fas fa-tv"></i><p>No Stream</p></div>
                        </div>
                        <div class="ad-banner auto" id="ffAdBottom">
                            <div class="ad-placeholder"><i class="fas fa-ad"></i><p>Ad</p></div>
                        </div>
                    </div>

                    <!-- BS Stream -->
                    <div class="stream-section bs">
                        <div class="stream-header bs">
                            <div class="stream-title">
                                <span class="icon">âš¡</span>
                                <span class="text">Blood Strike Live</span>
                            </div>
                            <div class="stream-live-badge" id="bsLiveBadge" style="display:none;">
                                <span class="dot"></span> LIVE
                            </div>
                        </div>
                        <div class="ad-banner auto" id="bsAdTop">
                            <div class="ad-placeholder"><i class="fas fa-ad"></i><p>Ad</p></div>
                        </div>
                        <div class="live-monitor" id="bsLiveMonitor">
                            <div class="live-monitor-placeholder bs"><i class="fas fa-tv"></i><p>No Stream</p></div>
                        </div>
                        <div class="ad-banner auto" id="bsAdBottom">
                            <div class="ad-placeholder"><i class="fas fa-ad"></i><p>Ad</p></div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="quick-action" onclick="showSection('groups')">
                            <i class="fas fa-users"></i><span>Groups</span>
                        </button>
                        <button class="quick-action" onclick="showSection('globalChat')">
                            <i class="fas fa-globe"></i><span>Global</span>
                        </button>
                        <button class="quick-action" onclick="showSection('gameChat')">
                            <i class="fas fa-gamepad"></i><span>Game</span>
                        </button>
                        <button class="quick-action" onclick="openModal('downloadModal')">
                            <i class="fas fa-download"></i><span>App</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- GROUPS Section -->
            <div class="section" id="groupsSection">
                <h3 class="section-title"><i class="fas fa-users"></i> My Groups</h3>
                <div class="group-actions">
                    <button class="group-action-btn" onclick="openModal('createGroupModal')">
                        <i class="fas fa-plus-circle"></i> Create
                    </button>
                    <button class="group-action-btn" onclick="openModal('joinGroupModal')">
                        <i class="fas fa-sign-in-alt"></i> Join
                    </button>
                </div>
                <div id="groupsList"></div>
            </div>

            <!-- GROUP VIEW -->
            <div class="group-view" id="groupView">
                <div class="gv-header">
                    <button class="gv-back" onclick="closeGroupView()"><i class="fas fa-arrow-left"></i></button>
                    <div class="gv-info">
                        <h3 id="gvName">Group</h3>
                        <p id="gvMembers">0 members</p>
                    </div>
                    <div class="gv-actions">
                        <button onclick="openModal('groupInfoModal')"><i class="fas fa-info-circle"></i></button>
                    </div>
                </div>
                <div class="gv-messages" id="gvMessages"></div>
                <div class="gv-input">
                    <input type="text" id="gvInput" placeholder="Message..." onkeypress="if(event.key==='Enter')sendGroupMsg()">
                    <button onclick="sendGroupMsg()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <!-- GLOBAL CHAT Section -->
            <div class="section" id="globalChatSection">
                <h3 class="section-title"><i class="fas fa-globe"></i> Global Chat</h3>
                <div class="chat-box">
                    <div class="chat-messages" id="globalMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="globalInput" placeholder="Message..." onkeypress="if(event.key==='Enter')sendGlobal()">
                        <button class="chat-send" onclick="sendGlobal()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <!-- GAME CHAT Section -->
            <div class="section" id="gameChatSection">
                <h3 class="section-title"><i class="fas fa-gamepad"></i> <span id="gameChatTitle">FF Chat</span></h3>
                <div class="chat-box">
                    <div class="chat-messages" id="gameMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="gameInput" placeholder="Message..." onkeypress="if(event.key==='Enter')sendGame()">
                        <button class="chat-send" onclick="sendGame()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <!-- PROFILE Section -->
            <div class="section" id="profileSection">
                <div class="profile-cover">
                    <div class="profile-avatar-box">
                        <div class="profile-avatar" id="profileAvatar">
                            ðŸ”¥
                            <div class="profile-status-dot" id="profileStatusDot"></div>
                        </div>
                    </div>
                </div>
                <div class="profile-info">
                    <h2 class="profile-name" id="profileName">Gamer</h2>
                    <p class="profile-email" id="profileEmail">email@example.com</p>
                    <span class="profile-game-badge" id="profileGame">Free Fire</span>
                </div>
                <div class="profile-stats">
                    <div class="profile-stat"><span class="value" id="statLevel">1</span><span class="label">Level</span></div>
                    <div class="profile-stat"><span class="value" id="statXP">0</span><span class="label">XP</span></div>
                    <div class="profile-stat"><span class="value" id="statMsgs">0</span><span class="label">Msgs</span></div>
                    <div class="profile-stat"><span class="value" id="statGroups">0</span><span class="label">Groups</span></div>
                </div>
                <div class="profile-option" onclick="openModal('editProfileModal')">
                    <i class="fas fa-edit"></i>
                    <div class="text"><h4>Edit Profile</h4><p>Change name & avatar</p></div>
                </div>
                <div class="profile-option" onclick="openModal('downloadModal')">
                    <i class="fas fa-download"></i>
                    <div class="text"><h4>Download App</h4><p>Get APK</p></div>
                </div>
                <div class="profile-option" onclick="shareApp()">
                    <i class="fas fa-share-alt"></i>
                    <div class="text"><h4>Invite Friends</h4><p>Share link</p></div>
                </div>
                <div class="profile-option" onclick="logout()" style="border: 1px solid var(--danger);">
                    <i class="fas fa-sign-out-alt" style="color: var(--danger);"></i>
                    <div class="text"><h4 style="color: var(--danger);">Logout</h4><p>Sign out</p></div>
                </div>
            </div>

            <!-- Bottom Nav -->
            <div class="bottom-nav">
                <button class="nav-item active" id="navHome" onclick="showSection('home')"><i class="fas fa-home"></i> Home</button>
                <button class="nav-item" onclick="toggleMenu()"><i class="fas fa-th-large"></i> Menu</button>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal" id="createGroupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-users"></i> Create Group</h3>
                <button class="modal-close" onclick="closeModal('createGroupModal')">âœ•</button>
            </div>
            <div class="form-group"><label>Group Name</label><input type="text" id="groupName" placeholder="My Squad"></div>
            <button class="btn btn-primary" onclick="createGroup()"><i class="fas fa-plus"></i> Create</button>
        </div>
    </div>

    <div class="modal" id="joinGroupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sign-in-alt"></i> Join Group</h3>
                <button class="modal-close" onclick="closeModal('joinGroupModal')">âœ•</button>
            </div>
            <div class="form-group"><label>6 Digit Code</label><input type="text" id="joinCode" placeholder="123456" maxlength="6" style="text-align:center;font-size:1.5rem;letter-spacing:8px;" inputmode="numeric"></div>
            <button class="btn btn-primary" onclick="joinGroup()"><i class="fas fa-sign-in-alt"></i> Join</button>
        </div>
    </div>

    <div class="modal" id="codeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Group Code</h3>
                <button class="modal-close" onclick="closeModal('codeModal')">âœ•</button>
            </div>
            <div class="code-box">
                <div class="code" id="displayCode">123456</div>
                <p style="color:var(--text-muted);margin-top:10px;font-size:0.85rem;">Share with friends</p>
            </div>
            <button class="btn btn-primary" onclick="copyCode()"><i class="fas fa-copy"></i> Copy</button>
        </div>
    </div>

    <div class="modal" id="groupInfoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> Group Info</h3>
                <button class="modal-close" onclick="closeModal('groupInfoModal')">âœ•</button>
            </div>
            <div class="code-box">
                <div class="code" id="groupInfoCode">123456</div>
                <p style="color:var(--text-muted);margin-top:10px;">Group Code</p>
            </div>
            <button class="btn btn-primary" onclick="copyGroupCode()"><i class="fas fa-copy"></i> Copy</button>
            <button class="btn btn-danger" style="margin-top:10px;" onclick="leaveGroup()"><i class="fas fa-sign-out-alt"></i> Leave</button>
        </div>
    </div>

    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Profile</h3>
                <button class="modal-close" onclick="closeModal('editProfileModal')">âœ•</button>
            </div>
            <label style="color:var(--text-muted);font-size:0.85rem;margin-bottom:10px;display:block;">Avatar</label>
            <div class="avatar-grid" id="avatarGrid"></div>
            <div class="form-group"><label>Name</label><input type="text" id="editName" placeholder="Your name"></div>
            <button class="btn btn-primary" onclick="saveProfile()"><i class="fas fa-save"></i> Save</button>
        </div>
    </div>

    <div class="modal" id="nameSetupModal">
        <div class="modal-content">
            <div class="name-setup">
                <div class="welcome-icon">ðŸŽ‰</div>
                <h2>Welcome!</h2>
                <p>Set your gamer name</p>
            </div>
            <label style="color:var(--text-muted);font-size:0.85rem;margin-bottom:10px;display:block;">Avatar</label>
            <div class="avatar-grid" id="setupAvatarGrid"></div>
            <div class="form-group"><label>Your Name</label><input type="text" id="setupName" placeholder="Enter name"></div>
            <button class="btn btn-primary" onclick="saveSetupName()"><i class="fas fa-check"></i> Let's Go!</button>
        </div>
    </div>

    <div class="modal" id="downloadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-download"></i> Download</h3>
                <button class="modal-close" onclick="closeModal('downloadModal')">âœ•</button>
            </div>
            <div class="name-setup">
                <div class="welcome-icon">ðŸ“±</div>
                <h2>Get Our App</h2>
                <p>Better experience</p>
            </div>
            <div class="download-options">
                <div class="download-option" onclick="downloadAPK()">
                    <div class="icon">ðŸ¤–</div>
                    <div class="text"><h4>Android APK</h4><p>Direct download</p></div>
                </div>
                <div class="download-option" onclick="addToHome()">
                    <div class="icon">ðŸ </div>
                    <div class="text"><h4>Add to Home</h4><p>Quick access</p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAT_0W3eL5Ipd2yzo-kR4NsggWqXoH_oJg",
            authDomain: "earning-pro-bot.firebaseapp.com",
            databaseURL: "https://earning-pro-bot-default-rtdb.firebaseio.com",
            projectId: "earning-pro-bot",
            storageBucket: "earning-pro-bot.firebasestorage.app",
            messagingSenderId: "917121638705",
            appId: "1:917121638705:web:bd9517193c42d19d0e5010"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Global Variables
        let user = null;
        let selectedGame = null;
        let selectedAvatar = 'ðŸ”¥';
        let setupAvatar = 'ðŸ”¥';
        let currentGroupId = null;
        let currentGroup = null;
        let notifSound = true;
        let lastMsgTime = {};
        let apkLink = '';
        let isConnected = false;
        let presenceRef = null;

        const avatars = ['ðŸ”¥','âš¡','ðŸ‘‘','ðŸŽ¯','ðŸŽ®','â­','ðŸ’Ž','ðŸ¦','ðŸ‰','ðŸ¤–'];
        const notifAudio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleWxOQXOo4N7LqpVaTD9Rq+brza+QVDlOhNDh/+y5h1YvPIC94v/zyZNiNS55qN3/+9CYaTA2aZfV//7Xn280NWaOzP//4aR0MS1fhcL//+ipeC8oWXe4///vr3wtIE9snf//9rWALho+XXX//fjAhzETO0hQ///7xow1DjE6Qf//+82ROQomMC3///TOlj0FHiYh///21Jk/ABgeF///+NeaQAAREw7///vZm0EAChAH////25xCAAYNAf///92eQwACCwD///7enkQAAQsA////36BEAAEKAf///+CgRQABCgH////goEUAAQoB////4KBFAAEKAf///+CgRQABCgH////goEUAAQoB////4KBFAA==');
        notifAudio.volume = 0.5;

        // ================================
        // INITIALIZATION
        // ================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('App initializing...');
            
            // Check network status
            updateNetworkStatus();
            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            
            // Load preferences
            notifSound = localStorage.getItem('notifSound') !== 'false';
            updateSoundUI();
            
            // Initialize avatar grids
            initAvatarGrids();
            
            // Setup Firebase connection monitoring
            setupFirebaseConnection();
            
            // Auth state listener
            auth.onAuthStateChanged(u => {
                console.log('Auth state changed:', u ? u.uid : 'null');
                if (u) {
                    loadUser(u.uid);
                } else {
                    hideLoading();
                }
            });
            
            // Load public stats
            loadSettings();
            loadPublicStats();
            
            // Hide loading after timeout
            setTimeout(hideLoading, 3000);
        });

        // ================================
        // NETWORK & CONNECTION MONITORING
        // ================================
        function updateNetworkStatus() {
            const online = navigator.onLine;
            const banner = document.getElementById('offlineBanner');
            const status1 = document.getElementById('networkStatus');
            const status2 = document.getElementById('networkStatus2');
            const text1 = document.getElementById('networkStatusText');
            const text2 = document.getElementById('networkStatusText2');
            
            if (online) {
                banner.classList.remove('show');
                if (status1) { status1.className = 'network-status online'; }
                if (status2) { status2.className = 'network-status online'; }
                if (text1) text1.textContent = 'Connected';
                if (text2) text2.textContent = 'Connected';
            } else {
                banner.classList.add('show');
                if (status1) { status1.className = 'network-status offline'; }
                if (status2) { status2.className = 'network-status offline'; }
                if (text1) text1.textContent = 'No Internet';
                if (text2) text2.textContent = 'No Internet';
            }
            
            updateStatusDots(online);
        }

        function setupFirebaseConnection() {
            const connectedRef = db.ref('.info/connected');
            
            connectedRef.on('value', (snap) => {
                isConnected = snap.val() === true;
                console.log('Firebase connected:', isConnected);
                
                updateStatusDots(isConnected);
                
                if (isConnected && user) {
                    setupPresence();
                }
            });
        }

        function setupPresence() {
            if (!user) return;
            
            console.log('Setting up presence for:', user.uid);
            
            const userStatusRef = db.ref('users/' + user.uid);
            const myConnectionsRef = db.ref('status/' + user.uid);
            
            // Remove old presence listeners
            if (presenceRef) {
                presenceRef.off();
            }
            
            presenceRef = db.ref('.info/connected');
            
            presenceRef.on('value', (snap) => {
                if (snap.val() === true) {
                    // Connected - set online
                    userStatusRef.update({
                        online: true,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    myConnectionsRef.set({
                        state: 'online',
                        lastChanged: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    // When I disconnect, update the last time I was seen online
                    userStatusRef.onDisconnect().update({
                        online: false,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    myConnectionsRef.onDisconnect().set({
                        state: 'offline',
                        lastChanged: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            });
        }

        function updateStatusDots(online) {
            const dots = [
                'headerStatusDot',
                'menuStatusDot',
                'profileStatusDot'
            ];
            
            dots.forEach(id => {
                const dot = document.getElementById(id);
                if (dot) {
                    if (online) {
                        dot.classList.remove('offline', 'connecting');
                    } else {
                        dot.classList.add('offline');
                    }
                }
            });
            
            const headerText = document.getElementById('headerOnlineText');
            if (headerText) {
                headerText.innerHTML = online ? 
                    '<span style="color: var(--success);">â— Online</span>' : 
                    '<span style="color: var(--danger);">â— Offline</span>';
            }
        }

        function hideLoading() {
            document.getElementById('loadingScreen').classList.add('hidden');
        }

        // ================================
        // AVATAR GRIDS
        // ================================
        function initAvatarGrids() {
            ['avatarGrid', 'setupAvatarGrid'].forEach(id => {
                const grid = document.getElementById(id);
                if (!grid) return;
                grid.innerHTML = '';
                avatars.forEach(a => {
                    const div = document.createElement('div');
                    div.className = 'avatar-opt' + (a === 'ðŸ”¥' ? ' selected' : '');
                    div.textContent = a;
                    div.onclick = () => {
                        grid.querySelectorAll('.avatar-opt').forEach(x => x.classList.remove('selected'));
                        div.classList.add('selected');
                        if (id === 'avatarGrid') selectedAvatar = a;
                        else setupAvatar = a;
                    };
                    grid.appendChild(div);
                });
            });
        }

        // ================================
        // NOTIFICATION SOUND
        // ================================
        function playNotif() {
            if (notifSound) {
                notifAudio.currentTime = 0;
                notifAudio.play().catch(() => {});
            }
        }

        function toggleNotifSound() {
            notifSound = !notifSound;
            localStorage.setItem('notifSound', notifSound);
            updateSoundUI();
            toast(notifSound ? 'Sound On ðŸ””' : 'Sound Off ðŸ”•');
        }

        function updateSoundUI() {
            const icon = document.getElementById('soundIcon');
            const btn = document.getElementById('soundBtn');
            const menuIcon = document.getElementById('menuSoundIcon');
            const menuText = document.getElementById('menuSoundText');
            
            if (notifSound) {
                if (icon) icon.className = 'fas fa-bell';
                if (btn) btn.classList.remove('muted');
                if (menuIcon) menuIcon.className = 'fas fa-bell';
                if (menuText) menuText.textContent = 'Sound: On';
            } else {
                if (icon) icon.className = 'fas fa-bell-slash';
                if (btn) btn.classList.add('muted');
                if (menuIcon) menuIcon.className = 'fas fa-bell-slash';
                if (menuText) menuText.textContent = 'Sound: Off';
            }
        }

        // ================================
        // DOWNLOAD & SHARE
        // ================================
        function downloadAPK() {
            if (apkLink) {
                window.open(apkLink, '_blank');
            } else {
                toast('APK not available', true);
            }
        }

        function addToHome() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            if (isIOS) {
                toast('Tap Share â†’ Add to Home Screen');
            } else {
                toast('Tap Menu (â‹®) â†’ Add to Home Screen');
            }
        }

        function shareApp() {
            const txt = 'Join Gaming Community! ðŸŽ®\n' + location.href;
            if (navigator.share) {
                navigator.share({ title: 'Gaming Community', text: txt, url: location.href });
            } else {
                navigator.clipboard.writeText(txt);
                toast('Link copied! ðŸ“‹');
            }
        }

        // ================================
        // LOAD PUBLIC STATS
        // ================================
        function loadPublicStats() {
            db.ref('users').on('value', snap => {
                const users = snap.val() || {};
                let total = 0, online = 0, ff = 0, bs = 0, msgs = 0;
                
                Object.values(users).forEach(u => {
                    total++;
                    if (u.online) online++;
                    if (u.game === 'ff') ff++;
                    if (u.game === 'bs') bs++;
                    msgs += u.messageCount || 0;
                });
                
                const liveCount = document.getElementById('liveCount');
                const liveCount2 = document.getElementById('liveCount2');
                const totalUsersEl = document.getElementById('totalUsers');
                const totalMsgsEl = document.getElementById('totalMsgs');
                const ffPlayersEl = document.getElementById('ffPlayers');
                const bsPlayersEl = document.getElementById('bsPlayers');
                
                if (liveCount) liveCount.textContent = online;
                if (liveCount2) liveCount2.textContent = online;
                if (totalUsersEl) totalUsersEl.textContent = total;
                if (totalMsgsEl) totalMsgsEl.textContent = msgs > 1000 ? (msgs/1000).toFixed(1) + 'K' : msgs;
                if (ffPlayersEl) ffPlayersEl.textContent = ff + ' players';
                if (bsPlayersEl) bsPlayersEl.textContent = bs + ' players';
            });
            
            db.ref('groups').on('value', snap => {
                const totalGroupsEl = document.getElementById('totalGroups');
                if (totalGroupsEl) {
                    totalGroupsEl.textContent = Object.keys(snap.val() || {}).length;
                }
            });
        }

        // ================================
        // LOAD SETTINGS
        // ================================
        function getYTEmbed(url) {
            if (!url) return null;
            let vid = null;
            if (url.includes('youtube.com/watch')) vid = url.split('v=')[1]?.split('&')[0];
            else if (url.includes('youtu.be/')) vid = url.split('youtu.be/')[1]?.split('?')[0];
            else if (url.includes('youtube.com/live/')) vid = url.split('live/')[1]?.split('?')[0];
            else if (url.includes('youtube.com/embed/')) vid = url.split('embed/')[1]?.split('?')[0];
            if (vid) return `https://www.youtube.com/embed/${vid}?autoplay=1&mute=0&rel=0&playsinline=1`;
            return url;
        }

        function loadSettings() {
            db.ref('settings').on('value', snap => {
                const s = snap.val() || {};
                apkLink = s.apkLink || '';

                // Maintenance check
                if (s.maintenance) {
                    document.getElementById('maintenanceMsg').textContent = s.maintenanceMessage || 'Under maintenance';
                    document.getElementById('maintenanceScreen').classList.add('active');
                    document.getElementById('signupScreen').classList.remove('active');
                    document.getElementById('loginScreen').classList.remove('active');
                    document.getElementById('mainApp').classList.remove('active');
                    hideLoading();
                    return;
                } else {
                    document.getElementById('maintenanceScreen').classList.remove('active');
                }

                // FF Stream
                const ffMonitor = document.getElementById('ffLiveMonitor');
                const ffBadge = document.getElementById('ffLiveBadge');
                if (s.ffLiveLink) {
                    const embed = getYTEmbed(s.ffLiveLink);
                    if (embed && ffMonitor) {
                        ffMonitor.innerHTML = `<iframe src="${embed}" allowfullscreen allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" playsinline></iframe>`;
                        if (ffBadge) ffBadge.style.display = 'flex';
                    }
                } else {
                    if (ffMonitor) ffMonitor.innerHTML = '<div class="live-monitor-placeholder ff"><i class="fas fa-tv"></i><p>No Stream</p></div>';
                    if (ffBadge) ffBadge.style.display = 'none';
                }

                // BS Stream
                const bsMonitor = document.getElementById('bsLiveMonitor');
                const bsBadge = document.getElementById('bsLiveBadge');
                if (s.bsLiveLink) {
                    const embed = getYTEmbed(s.bsLiveLink);
                    if (embed && bsMonitor) {
                        bsMonitor.innerHTML = `<iframe src="${embed}" allowfullscreen allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" playsinline></iframe>`;
                        if (bsBadge) bsBadge.style.display = 'flex';
                    }
                } else {
                    if (bsMonitor) bsMonitor.innerHTML = '<div class="live-monitor-placeholder bs"><i class="fas fa-tv"></i><p>No Stream</p></div>';
                    if (bsBadge) bsBadge.style.display = 'none';
                }

                // Ads
                updateAd('ffAdTop', s.ffAdTopImage, s.ffAdTopLink, s.ffAdTopSize);
                updateAd('ffAdBottom', s.ffAdBottomImage, s.ffAdBottomLink, s.ffAdBottomSize);
                updateAd('bsAdTop', s.bsAdTopImage, s.bsAdTopLink, s.bsAdTopSize);
                updateAd('bsAdBottom', s.bsAdBottomImage, s.bsAdBottomLink, s.bsAdBottomSize);
            });
        }

        function updateAd(id, img, link, size = 'auto') {
            const el = document.getElementById(id);
            if (!el) return;
            el.className = 'ad-banner ' + (size || 'auto');
            if (img) {
                el.innerHTML = link
                    ? `<a href="${link}" target="_blank" rel="noopener"><img src="${img}" onerror="this.parentElement.parentElement.innerHTML='<div class=ad-placeholder><i class=fas fa-ad></i></div>'"></a>`
                    : `<img src="${img}" onerror="this.parentElement.innerHTML='<div class=ad-placeholder><i class=fas fa-ad></i></div>'">`;
            } else {
                el.innerHTML = '<div class="ad-placeholder"><i class="fas fa-ad"></i></div>';
            }
        }

        // ================================
        // MENU & NAVIGATION
        // ================================
        function toggleMenu() {
            document.getElementById('sideMenu').classList.toggle('active');
            document.getElementById('menuOverlay').classList.toggle('active');
        }

        function menuNav(s) {
            toggleMenu();
            showSection(s);
        }

        function showLogin() {
            document.getElementById('signupScreen').classList.remove('active');
            document.getElementById('loginScreen').classList.add('active');
        }

        function showSignup() {
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('signupScreen').classList.add('active');
        }

        function selectGame(g) {
            selectedGame = g;
            document.querySelectorAll('.game-card').forEach(c => c.classList.remove('selected'));
            document.getElementById(g + 'Card').classList.add('selected');
        }

        // ================================
        // AUTH - SIGNUP & LOGIN
        // ================================
        function signup() {
            if (!navigator.onLine) return toast('No internet connection!', true);
            
            const email = document.getElementById('signupEmail').value.trim();
            const pass = document.getElementById('signupPassword').value;
            
            if (!selectedGame) return toast('Select game!', true);
            if (!email || !email.includes('@')) return toast('Valid email required!', true);
            if (pass.length < 6) return toast('Password 6+ chars!', true);

            const btn = document.getElementById('signupBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span>';

            auth.createUserWithEmailAndPassword(email, pass)
                .then(cred => {
                    return db.ref('users/' + cred.user.uid).set({
                        name: email.split('@')[0],
                        email,
                        game: selectedGame,
                        avatar: selectedGame === 'ff' ? 'ðŸ”¥' : 'âš¡',
                        createdAt: firebase.database.ServerValue.TIMESTAMP,
                        messageCount: 0,
                        xp: 100,
                        level: 1,
                        online: true,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP,
                        suspended: false,
                        needsNameSetup: true
                    });
                })
                .then(() => toast('Welcome! ðŸŽ‰'))
                .catch(e => {
                    console.error('Signup error:', e);
                    toast(e.code === 'auth/email-already-in-use' ? 'Email exists!' : e.message, true);
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-rocket"></i> Join Now - Free!';
                });
        }

        function login() {
            if (!navigator.onLine) return toast('No internet connection!', true);
            
            const email = document.getElementById('loginEmail').value.trim();
            const pass = document.getElementById('loginPassword').value;
            
            if (!email || !pass) return toast('Enter credentials!', true);

            const btn = document.getElementById('loginBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span>';

            auth.signInWithEmailAndPassword(email, pass)
                .then(() => toast('Welcome back! ðŸŽ‰'))
                .catch(e => {
                    console.error('Login error:', e);
                    toast('Invalid credentials!', true);
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                });
        }

        // ================================
        // USER LOADING
        // ================================
        function loadUser(uid) {
            console.log('Loading user:', uid);
            
            db.ref('users/' + uid).on('value', snap => {
                if (!snap.exists()) {
                    hideLoading();
                    return;
                }
                
                user = snap.val();
                user.uid = uid;

                if (user.suspended) {
                    alert('Suspended: ' + (user.suspendReason || 'Rule violation'));
                    logout();
                    return;
                }

                document.body.className = user.game + '-theme';
                document.getElementById('signupScreen').classList.remove('active');
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('mainApp').classList.add('active');

                if (user.needsNameSetup) {
                    document.getElementById('setupName').value = user.name || '';
                    openModal('nameSetupModal');
                }

                updateUI();
                loadGroups();
                loadGlobalChat();
                loadGameChat();
                
                // Setup presence
                setupPresence();
                
                hideLoading();
            });
        }

        function saveSetupName() {
            const name = document.getElementById('setupName').value.trim();
            if (!name || name.length < 2) return toast('Enter valid name!', true);
            
            db.ref('users/' + user.uid).update({
                name,
                avatar: setupAvatar,
                needsNameSetup: false
            }).then(() => {
                closeModal('nameSetupModal');
                toast('Welcome, ' + name + '! ðŸŽ®');
            });
        }

        function updateUI() {
            if (!user) return;
            
            const gn = user.game === 'ff' ? 'Free Fire' : 'Blood Strike';
            const gi = user.game === 'ff' ? 'ðŸ”¥' : 'âš¡';
            const avatar = user.avatar || gi;

            // Header
            const headerAvatar = document.getElementById('headerAvatar');
            if (headerAvatar) {
                headerAvatar.innerHTML = avatar + '<div class="status-dot" id="headerStatusDot"></div>';
            }
            
            const headerName = document.getElementById('headerName');
            if (headerName) headerName.textContent = user.name;
            
            const headerGameText = document.getElementById('headerGameText');
            if (headerGameText) headerGameText.textContent = gn;

            // Menu
            const menuAvatar = document.getElementById('menuAvatar');
            if (menuAvatar) menuAvatar.textContent = avatar;
            
            const menuName = document.getElementById('menuName');
            if (menuName) menuName.textContent = user.name;
            
            const menuGame = document.getElementById('menuGame');
            if (menuGame) menuGame.textContent = gn;
            
            const menuGameChat = document.getElementById('menuGameChat');
            if (menuGameChat) menuGameChat.textContent = (user.game === 'ff' ? 'FF' : 'BS') + ' Chat';

            // Profile
            const profileAvatar = document.getElementById('profileAvatar');
            if (profileAvatar) {
                profileAvatar.innerHTML = avatar + '<div class="profile-status-dot" id="profileStatusDot"></div>';
            }
            
            const profileName = document.getElementById('profileName');
            if (profileName) profileName.textContent = user.name;
            
            const profileEmail = document.getElementById('profileEmail');
            if (profileEmail) profileEmail.textContent = user.email;
            
            const profileGame = document.getElementById('profileGame');
            if (profileGame) {
                profileGame.textContent = gn;
                profileGame.style.background = user.game === 'ff' ? '#f97316' : '#06b6d4';
            }
            
            // Stats
            const statLevel = document.getElementById('statLevel');
            if (statLevel) statLevel.textContent = user.level || 1;
            
            const statXP = document.getElementById('statXP');
            if (statXP) statXP.textContent = user.xp || 0;
            
            const statMsgs = document.getElementById('statMsgs');
            if (statMsgs) statMsgs.textContent = user.messageCount || 0;
            
            // Edit name
            const editName = document.getElementById('editName');
            if (editName) editName.value = user.name;
            
            // Game chat title
            const gameChatTitle = document.getElementById('gameChatTitle');
            if (gameChatTitle) gameChatTitle.textContent = (user.game === 'ff' ? 'FF' : 'BS') + ' Chat';

            // Avatar selection
            selectedAvatar = avatar;
            document.querySelectorAll('#avatarGrid .avatar-opt').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.textContent === selectedAvatar) opt.classList.add('selected');
            });

            // Update status dots
            updateStatusDots(isConnected);
        }

        function saveProfile() {
            const name = document.getElementById('editName').value.trim();
            if (!name || name.length < 2) return toast('Enter valid name!', true);

            db.ref('users/' + user.uid).update({ name, avatar: selectedAvatar }).then(() => {
                // Update in groups
                db.ref('groups').once('value').then(snap => {
                    snap.forEach(c => {
                        if (c.val().members?.[user.uid]) {
                            db.ref('groups/' + c.key + '/members/' + user.uid).update({
                                name,
                                avatar: selectedAvatar
                            });
                        }
                    });
                });
                closeModal('editProfileModal');
                toast('Saved! âœ…');
            });
        }

        function logout() {
            if (!confirm('Logout?')) return;
            
            if (document.getElementById('sideMenu').classList.contains('active')) toggleMenu();

            if (user) {
                // Set offline
                db.ref('users/' + user.uid).update({
                    online: false,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP
                });
                db.ref('users/' + user.uid).off();
                
                if (presenceRef) {
                    presenceRef.off();
                    presenceRef = null;
                }
            }

            auth.signOut().then(() => {
                user = null;
                document.body.className = '';
                document.getElementById('mainApp').classList.remove('active');
                document.getElementById('signupScreen').classList.add('active');
                document.querySelectorAll('.game-card').forEach(c => c.classList.remove('selected'));
                selectedGame = null;
                toast('Logged out!');
            });
        }

        // ================================
        // SECTIONS
        // ================================
        function showSection(s) {
            document.getElementById('groupView').classList.remove('active');
            document.querySelectorAll('.section').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
            
            const map = {
                home: 'homeSection',
                groups: 'groupsSection',
                globalChat: 'globalChatSection',
                gameChat: 'gameChatSection',
                profile: 'profileSection'
            };
            
            const section = document.getElementById(map[s]);
            if (section) section.classList.add('active');
            
            if (s === 'home') {
                const navHome = document.getElementById('navHome');
                if (navHome) navHome.classList.add('active');
            }
            
            if (s === 'groups') loadGroups();
        }

        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // ================================
        // GROUPS
        // ================================
        function createGroup() {
            if (!navigator.onLine) return toast('No internet!', true);
            
            const name = document.getElementById('groupName').value.trim();
            if (!name) return toast('Enter name!', true);
            
            const code = String(Math.floor(100000 + Math.random() * 900000));
            
            db.ref('groups').push({
                name,
                code,
                game: user.game,
                createdAt: firebase.database.ServerValue.TIMESTAMP,
                members: {
                    [user.uid]: {
                        name: user.name,
                        avatar: user.avatar,
                        role: 'leader',
                        joinedAt: firebase.database.ServerValue.TIMESTAMP
                    }
                }
            }).then(() => {
                closeModal('createGroupModal');
                document.getElementById('groupName').value = '';
                document.getElementById('displayCode').textContent = code;
                openModal('codeModal');
                loadGroups();
                toast('Created! ðŸ‘‘');
            });
        }

        function joinGroup() {
            if (!navigator.onLine) return toast('No internet!', true);
            
            const code = document.getElementById('joinCode').value.trim();
            if (code.length !== 6) return toast('6 digits!', true);
            
            db.ref('groups').orderByChild('code').equalTo(code).once('value').then(snap => {
                if (!snap.exists()) return toast('Invalid code!', true);
                
                snap.forEach(c => {
                    const g = c.val();
                    if (g.game !== user.game) return toast('Different game!', true);
                    if (g.members?.[user.uid]) return toast('Already joined!', true);
                    
                    db.ref('groups/' + c.key + '/members/' + user.uid).set({
                        name: user.name,
                        avatar: user.avatar,
                        role: 'member',
                        joinedAt: firebase.database.ServerValue.TIMESTAMP
                    }).then(() => {
                        closeModal('joinGroupModal');
                        document.getElementById('joinCode').value = '';
                        loadGroups();
                        toast('Joined! ðŸŽ‰');
                    });
                });
            });
        }

        function loadGroups() {
            if (!user) return;
            
            db.ref('groups').orderByChild('game').equalTo(user.game).once('value').then(snap => {
                let html = '', count = 0;
                
                snap.forEach(c => {
                    const g = c.val();
                    if (g.members?.[user.uid]) {
                        count++;
                        const mc = Object.keys(g.members).length;
                        const badge = g.members[user.uid].role === 'leader' ? '<span class="role-badge leader">ðŸ‘‘</span>' : '';
                        html += `<div class="group-card" onclick="openGroup('${c.key}')">
                            <div class="group-header">
                                <div class="group-avatar">${g.name.charAt(0)}</div>
                                <div class="group-title"><h4>${g.name}${badge}</h4><p>${mc} members</p></div>
                                <div class="group-code">${g.code}</div>
                            </div>
                        </div>`;
                    }
                });
                
                const statGroups = document.getElementById('statGroups');
                if (statGroups) statGroups.textContent = count;
                
                const groupsList = document.getElementById('groupsList');
                if (groupsList) {
                    groupsList.innerHTML = html || '<div class="empty-state"><i class="fas fa-users"></i><p>No groups</p></div>';
                }
            });
        }

        function openGroup(gid) {
            currentGroupId = gid;
            
            db.ref('groups/' + gid).once('value').then(snap => {
                if (!snap.exists()) return;
                
                currentGroup = snap.val();
                currentGroup.id = gid;
                
                const gvName = document.getElementById('gvName');
                if (gvName) gvName.textContent = currentGroup.name;
                
                const gvMembers = document.getElementById('gvMembers');
                if (gvMembers) gvMembers.textContent = Object.keys(currentGroup.members).length + ' members';
                
                const groupInfoCode = document.getElementById('groupInfoCode');
                if (groupInfoCode) groupInfoCode.textContent = currentGroup.code;
                
                lastMsgTime['g_' + gid] = Date.now();
                loadGroupChat();
                
                document.querySelectorAll('.section').forEach(x => x.classList.remove('active'));
                document.getElementById('groupView').classList.add('active');
            });
        }

        function closeGroupView() {
            document.getElementById('groupView').classList.remove('active');
            if (currentGroupId) db.ref('groupChats/' + currentGroupId).off();
            currentGroupId = null;
            currentGroup = null;
            showSection('groups');
        }

        function leaveGroup() {
            if (!currentGroup) return;
            
            const role = currentGroup.members[user.uid]?.role;
            if (role === 'leader' && Object.keys(currentGroup.members).length > 1) {
                return toast('Transfer leadership first!', true);
            }
            
            if (!confirm('Leave?')) return;
            
            if (Object.keys(currentGroup.members).length === 1) {
                db.ref('groups/' + currentGroupId).remove();
                db.ref('groupChats/' + currentGroupId).remove();
            } else {
                db.ref('groups/' + currentGroupId + '/members/' + user.uid).remove();
            }
            
            closeModal('groupInfoModal');
            closeGroupView();
            toast('Left!');
        }

        function copyCode() {
            navigator.clipboard.writeText(document.getElementById('displayCode').textContent);
            toast('Copied! ðŸ“‹');
        }

        function copyGroupCode() {
            navigator.clipboard.writeText(document.getElementById('groupInfoCode').textContent);
            toast('Copied! ðŸ“‹');
        }

        function loadGroupChat() {
            if (!currentGroupId) return;
            
            db.ref('groupChats/' + currentGroupId).off();
            db.ref('groupChats/' + currentGroupId).orderByChild('time').limitToLast(100).on('value', snap => {
                let html = '', hasNew = false;
                
                snap.forEach(c => {
                    const m = c.val();
                    const own = m.uid === user.uid;
                    if (!own && m.time > (lastMsgTime['g_' + currentGroupId] || 0)) hasNew = true;
                    
                    html += `<div class="message ${own ? 'own' : ''}">
                        <div class="msg-avatar">${m.avatar || m.name?.charAt(0) || '?'}</div>
                        <div class="msg-content">
                            <div class="msg-header"><span class="msg-name">${m.name}</span><span class="msg-time">${fmtTime(m.time)}</span></div>
                            <div class="msg-text">${esc(m.text)}</div>
                        </div>
                    </div>`;
                });
                
                const cont = document.getElementById('gvMessages');
                if (cont) {
                    cont.innerHTML = html || '<div class="empty-state"><p>No messages</p></div>';
                    cont.scrollTop = cont.scrollHeight;
                }
                
                if (hasNew) {
                    playNotif();
                    lastMsgTime['g_' + currentGroupId] = Date.now();
                }
            });
        }

        function sendGroupMsg() {
            if (!navigator.onLine) return toast('No internet!', true);
            
            const input = document.getElementById('gvInput');
            const text = input.value.trim();
            if (!text || !user || !currentGroupId) return;
            
            lastMsgTime['g_' + currentGroupId] = Date.now();
            
            db.ref('groupChats/' + currentGroupId).push({
                uid: user.uid,
                name: user.name,
                avatar: user.avatar,
                text,
                time: firebase.database.ServerValue.TIMESTAMP
            }).then(() => addXP(5));
            
            input.value = '';
        }

        // ================================
        // CHATS
        // ================================
        function loadGlobalChat() {
            if (!user) return;
            
            lastMsgTime['global'] = Date.now();
            db.ref('chats/global').off();
            
            db.ref('chats/global').orderByChild('time').limitToLast(50).on('value', snap => {
                let html = '', hasNew = false;
                
                snap.forEach(c => {
                    const m = c.val();
                    const own = m.uid === user.uid;
                    const isAnn = m.isAnnouncement;
                    if (!own && m.time > (lastMsgTime['global'] || 0)) hasNew = true;
                    
                    html += `<div class="message ${own ? 'own' : ''} ${isAnn ? 'announcement' : ''}">
                        <div class="msg-avatar ${m.game || ''}">${m.avatar || m.name?.charAt(0) || '?'}</div>
                        <div class="msg-content">
                            <div class="msg-header">
                                <span class="msg-name">${m.name}</span>
                                ${m.game ? `<span class="msg-badge ${m.game}">${m.game.toUpperCase()}</span>` : ''}
                                <span class="msg-time">${fmtTime(m.time)}</span>
                            </div>
                            <div class="msg-text">${esc(m.text)}</div>
                        </div>
                    </div>`;
                });
                
                const cont = document.getElementById('globalMessages');
                if (cont) {
                    cont.innerHTML = html || '<div class="empty-state"><p>No messages</p></div>';
                    cont.scrollTop = cont.scrollHeight;
                }
                
                if (hasNew && document.getElementById('globalChatSection').classList.contains('active')) {
                    playNotif();
                }
                lastMsgTime['global'] = Date.now();
            });
        }

        function sendGlobal() {
            if (!navigator.onLine) return toast('No internet!', true);
            
            const input = document.getElementById('globalInput');
            const text = input.value.trim();
            if (!text || !user) return;
            
            lastMsgTime['global'] = Date.now();
            
            db.ref('chats/global').push({
                uid: user.uid,
                name: user.name,
                avatar: user.avatar,
                game: user.game,
                text,
                time: firebase.database.ServerValue.TIMESTAMP
            }).then(() => addXP(5));
            
            input.value = '';
        }

        function loadGameChat() {
            if (!user) return;
            
            lastMsgTime['game'] = Date.now();
            db.ref('chats/' + user.game).off();
            
            db.ref('chats/' + user.game).orderByChild('time').limitToLast(50).on('value', snap => {
                let html = '', hasNew = false;
                
                snap.forEach(c => {
                    const m = c.val();
                    const own = m.uid === user.uid;
                    const isAnn = m.isAnnouncement;
                    if (!own && m.time > (lastMsgTime['game'] || 0)) hasNew = true;
                    
                    html += `<div class="message ${own ? 'own' : ''} ${isAnn ? 'announcement' : ''}">
                        <div class="msg-avatar ${m.game || ''}">${m.avatar || m.name?.charAt(0) || '?'}</div>
                        <div class="msg-content">
                            <div class="msg-header"><span class="msg-name">${m.name}</span><span class="msg-time">${fmtTime(m.time)}</span></div>
                            <div class="msg-text">${esc(m.text)}</div>
                        </div>
                    </div>`;
                });
                
                const cont = document.getElementById('gameMessages');
                if (cont) {
                    cont.innerHTML = html || '<div class="empty-state"><p>No messages</p></div>';
                    cont.scrollTop = cont.scrollHeight;
                }
                
                if (hasNew && document.getElementById('gameChatSection').classList.contains('active')) {
                    playNotif();
                }
                lastMsgTime['game'] = Date.now();
            });
        }

        function sendGame() {
            if (!navigator.onLine) return toast('No internet!', true);
            
            const input = document.getElementById('gameInput');
            const text = input.value.trim();
            if (!text || !user) return;
            
            lastMsgTime['game'] = Date.now();
            
            db.ref('chats/' + user.game).push({
                uid: user.uid,
                name: user.name,
                avatar: user.avatar,
                game: user.game,
                text,
                time: firebase.database.ServerValue.TIMESTAMP
            }).then(() => addXP(5));
            
            input.value = '';
        }

        // ================================
        // XP SYSTEM
        // ================================
        function addXP(amt) {
            if (!user) return;
            
            user.xp = (user.xp || 0) + amt;
            user.messageCount = (user.messageCount || 0) + 1;
            
            const lvl = user.level || 1;
            const req = lvl * 100;
            let upd = { xp: user.xp, messageCount: user.messageCount };
            
            if (user.xp >= req) {
                user.level = lvl + 1;
                user.xp -= req;
                upd.level = user.level;
                upd.xp = user.xp;
                setTimeout(() => toast('Level ' + user.level + '! ðŸŽ‰'), 500);
            }
            
            db.ref('users/' + user.uid).update(upd);
        }

        // ================================
        // UTILITIES
        // ================================
        function fmtTime(ts) {
            if (!ts) return '';
            return new Date(ts).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        function esc(t) {
            const d = document.createElement('div');
            d.textContent = t;
            return d.innerHTML;
        }

        function toast(msg, err = false) {
            const t = document.getElementById('toast');
            const txt = document.getElementById('toastText');
            if (txt) txt.textContent = msg;
            t.className = 'toast' + (err ? ' error' : '');
            t.querySelector('i').className = err ? 'fas fa-exclamation-circle' : 'fas fa-check-circle';
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        // ================================
        // CLEANUP ON UNLOAD
        // ================================
        window.addEventListener('beforeunload', () => {
            if (user) {
                // Try to set offline
                const data = JSON.stringify({ online: false });
                navigator.sendBeacon && navigator.sendBeacon(
                    `https://earning-pro-bot-default-rtdb.firebaseio.com/users/${user.uid}.json`,
                    data
                );
            }
        });

        // Handle visibility change
        document.addEventListener('visibilitychange', () => {
            if (user && isConnected) {
                if (document.hidden) {
                    // Tab hidden - still online but could go offline soon
                } else {
                    // Tab visible - ensure online
                    db.ref('users/' + user.uid).update({
                        online: true,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            }
        });
    </script>
</body>
 <script src="https://reportallege.com/81/ae/bd/81aebd844d1b87ecc994085355f5fa3c.js"></script> <script src="https://reportallege.com/81/ae/bd/81aebd844d1b87ecc994085355f5fa3c.js"></script>
</html>
